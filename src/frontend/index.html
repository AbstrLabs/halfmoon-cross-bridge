<!-- This page is a simple frontend to show instruction and to run API calls -->
<!-- TODO: dynamically remove default values -->
<!-- TODO: what if NEAR RPC is down? https://status.nearprotocol.com/ -->
<!-- TODO: 2. before mint, user should opt in to goNEAR ASA [check with code] -->
<!-- TODO: 3. before API call, user should make a transaction, and use the returned txnId -->
<!-- TODO: 4. on button click: pass 4 params(to,from,amount,txnId) to API in server.ts -->

<!-- TODO: input place holder, upto 10 digits, address -->
<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link rel="stylesheet" href="./index.css" />
    <title>Algorand - NEAR Bridge</title>
  </head>

  <body>
    <header>
      <h1>Algorand - NEAR Bridge</h1>
      <p>This is a demo of the Algorand Bridge for NEAR.</p>
      <label>
        <input
          type="checkbox"
          name="example-data"
          id="example-data-checkbox"
          checked
        />
        Use Example Data
      </label>
    </header>

    <div role="body">
      <!-- TODO: we don't need connect both wallet. Move them to respective process -->

      <div id="txn">
        <!-- todo: merge #txn to body -->
        <div role="tab-switch">
          <ul class="tabs func-selection" role="tablist">
            <li class="func-selection">
              <input
                type="radio"
                name="tabs"
                id="mint-tab-switch"
                class="func-selection"
              />
              <label
                for="mint-tab-switch"
                role="tab"
                aria-controls="mint"
                class="func-selection"
                tabindex="0"
              >
                mint
              </label>
            </li>
            <li class="func-selection">
              <input
                type="radio"
                name="tabs"
                id="burn-tab-switch"
                checked
                class="func-selection"
              />
              <label
                for="burn-tab-switch"
                role="tab"
                aria-controls="burn"
                class="func-selection"
                tabindex="1"
              >
                burn
              </label>
            </li>
          </ul>
        </div>

        <div id="mint" role="tab-panel">
          <div role="left-column">
            <h3>NOTE:</h3>
            <span
              >(TEMP,can check with wallet) Make sure your Algorand account has
              Opted In to the goNEAR asset</span
            >
            <br />

            <div id="" class="wallet-wrap">
              <button id="near-connect-btn">Connect NEAR Wallet</button>
              <p id="near-address"></p>
              <button id="near-signout-btn" style="display: none">
                Sign Out
              </button>
            </div>
            <br />
            <br />
            <form>
              <label>
                Amount (NEAR)
                <br />
                <input
                  type="number"
                  name="mint_amount"
                  id="mint_amount"
                  placeholder="like 1.357, up to 10 decimals"
                  step="0.0000000001"
                  required
                />
              </label>
              <br />
              <label>
                Beneficiary (Algorand public address)
                <br />
                <input
                  type="text"
                  name="mint_to"
                  id="mint_to"
                  placeholder="like ACCSSTKTJDSVP4JPTJWNCGWSDAPHR66ES2AZUAH7MUULEY43DHQSDNR7DA"
                  required
                />
              </label>
              <!-- <br />
              <label>
                From (NEAR public address) (read from wallet)
                <br />
                <input type="text" name="mint_from" id="mint_to" value="abstrlabs-test.testnet" size="50" disabled />
              </label> -->
              <br />
            </form>
            Receiving XXX goNEAR on Algorand Account YYY
            <br />
            <button
              id="near-request-transfer"
              class="clickBtn"
              onclick="requestSignNearTxn($('input#mint_amount').val())"
            >
              Authorize Mint Transaction
            </button>
          </div>
        </div>

        <div id="burn" role="tab-panel">
          <div>
            <div class="wallet-wrap">
              <button id="algorand-connect-btn" onclick="connectToMyAlgo()">
                Connect My Algo Wallet
              </button>
              <p id="algo-address"></p>
              <!-- <button id="algorand-optin" onclick="optInGoNear()">goNEAR Opt In(skip if finished
                first time)</button> -->
            </div>
            <form>
              <label>
                Amount (goNEAR)
                <br />
                <input
                  type="number"
                  name="burn_amount"
                  id="burn_amount"
                  placeholder="like 1.357, up to 10 decimals"
                  step="0.0000000001"
                  required
                />
              </label>
              <br />
              <label>
                Beneficiary (NEAR public address)
                <br />
                <input
                  type="text"
                  id="burn_to"
                  placeholder="like abstrlabs-test.testnet"
                  required
                />
              </label>
              <!-- <label>
                Transaction ID (Algorand)
                <br />
                <input type="text" name="burn_txnId" id="burn_txnId"
                  value="Am1ZQx651WwYXZzBbtKV35YYPP6Tc5epvCfebv5XRn4K" size="50" required>
              </label> -->
              <br />
            </form>
            <!-- <button id="check-tx-algo" onclick="checkAlgoTx()" class="clickBtn" required>Hash Check</button> -->
            <!-- <button id="algorand-transfer" onclick="goNEARTransfer()" class="clickBtn" disabled>Transfer</button> -->
            <button id="burn-confirm" class="clickBtn" onclick="confirmBurn()">
              Confirm
            </button>
          </div>
        </div>
      </div>
    </div>
  </body>

  <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/near-api-js@0.41.0/dist/near-api-js.min.js"></script>
  <script
    src="https://cdn.jsdelivr.net/npm/algosdk@v1.16.0/dist/browser/algosdk.min.js"
    crossorigin="anonymous"
  ></script>

  <!-- <script src="index.js" type="module"></script> -->
  <script src="./dependencies/myalgo.min.js"></script>
  <script src="./near.js" comment="NEAR wallet connect"></script>
  <script src="./algo.js" comment="Algorand wallet connect"></script>

  <!-- RENDER PAGE -->
  <script comment="constants">
    window.CONSTANT = {
      ALGO_MASTER_ACCOUNT: '',
      EXAMPLE_MINT_BENEFICIARY:
        'ACCSSTKTJDSVP4JPTJWNCGWSDAPHR66ES2AZUAH7MUULEY43DHQSDNR7DA',
      EXAMPLE_MINT_AMOUNT: '1.3579',
      EXAMPLE_BURN_BENEFICIARY: 'abstrlabs-test.testnet',
      EXAMPLE_BURN_AMOUNT: '1.2345',
    };
  </script>

  <script comment="tab-switch-handler">
    /*tab selection for mint and burn*/
    let mintTabSwitch = $('#mint-tab-switch')[0];
    let burnTabSwitch = $('#burn-tab-switch')[0];
    let mintTabContent = $('#mint')[0];
    let burnTabContent = $('#burn')[0];

    const renderTabSwitch = () => {
      if (mintTabSwitch.checked === true) {
        mintTabContent.style.display = 'grid';
      } else {
        mintTabContent.style.display = 'none';
      }
      if (burnTabSwitch.checked === true) {
        burnTabContent.style.display = 'grid';
      } else {
        burnTabContent.style.display = 'none';
      }
    };
    mintTabSwitch.addEventListener('change', (event) => {
      renderTabSwitch();
    });

    burnTabSwitch.addEventListener('change', (event) => {
      renderTabSwitch();
    });
  </script>
  <script comment="example-data">
    let box = $('#example-data-checkbox')[0];
    console.log('box : ', box); // DEV_LOG_TO_REMOVE
    const renderExampleData = () => {
      if (box.checked === true) {
        $('input#mint_amount').val(window.CONSTANT.EXAMPLE_MINT_AMOUNT);
        $('input#mint_to').val(window.CONSTANT.EXAMPLE_MINT_BENEFICIARY);
        $('input#burn_amount').val(window.CONSTANT.EXAMPLE_BURN_AMOUNT);
        $('input#burn_to').val(window.CONSTANT.EXAMPLE_BURN_BENEFICIARY);
      } else {
        $('input#mint_amount').val('');
        $('input#mint_to').val('');
        $('input#burn_amount').val('');
        $('input#burn_to').val('');
      }
    };
    box.addEventListener('change', (event) => {
      renderExampleData();
    });
  </script>
  <script comment="run on start">
    renderTabSwitch();
    renderExampleData();
  </script>
</html>
