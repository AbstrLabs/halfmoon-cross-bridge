<!-- This page is a simple frontend to show instruction and to run API calls -->
<!-- TODO: dynamically remove default values -->

<!DOCTYPE html>
<html lang="en">

  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <style>
      * {
        box-sizing: border-box;
        background-color: #000;
        color: #fff;
      }

      html {
        font-size: 24px;
      }

      table,
      th,
      td {
        border-collapse: collapse;
        border: 1px solid #fff;
      }
    </style>
    <title>Algorand - NEAR Bridge</title>
  </head>

  <body>
    <header>
      <h1>Algorand - NEAR Bridge</h1>
      <p>This is a demo of the Algorand Bridge for NEAR.</p>
      <input type="checkbox" name="use_default_value" id="use_default_value" checked>Use default value</div>
    </header>

    <div id="app">
      <div id="btn-group">
        <button id="near-connect-btn">Connect NEAR Wallet</button>
      </div>
      <div id="txn">

        <div>
          <h2>Mint</h2>
          <form action="/api/mint" method="post">
            <label>
              From (NEAR public address)
              <input type="text" name="mint_from" id="mint_from" value="abstrlabs-test.testnet" />
            </label>
            <br />
            <label>
              To (Algorand public address)
              <input type="text" name="mint_to" value="ACCSSTKTJDSVP4JPTJWNCGWSDAPHR66ES2AZUAH7MUULEY43DHQSDNR7DA" />
            </label>
            <br />
            <label>
              Amount
              <input type="number" name="mint_amount" value="456.789" />
            </label>
            <label>Transaction ID
              <input type="text" name="mint_txid">
            </label>
            <button>MINT</button>
          </form>
        </div>

        <div>
          <h2>Burn</h2>
          <form action="/api/mint" method="post">
            <label>
              From (Algorand public address)
              <input type="text" name="burn_from" value="abstrlabs-test.testnet" />
            </label>
            <br />
            <label>
              To (NEAR public address)
              <input type="text" name="burn_to" value="ACCSSTKTJDSVP4JPTJWNCGWSDAPHR66ES2AZUAH7MUULEY43DHQSDNR7DA" />
            </label>
            <br />
            <label>
              Amount
              <input type="number" name="burn_amount" value="987.654" />
            </label>
            <label>Transaction ID
              <input type="text" name="burn_txid">
            </label>
            <button>BURN</button>
          </form>
        </div>
      </div>

      <a
        href="https://dispenser.testnet.aws.algodev.network/?account=JMJLRBZQSTS6ZINTD3LLSXCW46K44EI2YZHYKCPBGZP3FLITIQRGPELOBE">testnet
        dispense algorand main acc</a>
      <p>Some log should come here.</p>
    </div>

    <footer>
      <h2>
        Site Map
      </h2>
      <table>
        <tr>
          <td>route</td>
          <td>functionality</td>
          <td>Params</td>
          <td></td>
          <td></td>
        </tr>
        <tr>
          <td>/</td>
          <td>Instruction & Example (This page)</td>
          <td>N/A</td>
          <td></td>
          <td></td>
        </tr>
        <tr>
          <td>/api</td>
          <td>API root</td>
          <td>N/A</td>
          <td></td>
          <td></td>
        </tr>
        <tr>
          <td>/api/mint?from=${MINT_FROM}&to=${MINT_TO}&amount=${MINT_AMOUNT}&txid=${TXID}</td>
          <td>Mint API (POST)</td>
          <td>from,to,amount,txid</td>
          <td></td>
          <td></td>
        </tr>
        <tr>
          <td>/api/burn?from=${BURN_FROM}&to=${BURN_TO}&amount=${BURN_AMOUNT}&txid=${TXID}</td>
          <td>Burn API (POST)</td>
          <td>from,to,amount,txid</td>
          <td></td>
          <td></td>
        </tr>
        <tr>
          <td>/history</td>
          <td>History</td>
          <td>[txid]</td>
          <td></td>
          <td></td>
        </tr>
      </table>
    </footer>
  </body>

  <script src="https://cdn.jsdelivr.net/npm/near-api-js@0.41.0/dist/near-api-js.min.js"></script>
  <script>
    /* NEAR wallet CONNECT */

    // modified from https://docs.near.org/docs/faq/naj-faq
    // connect to NEAR
    const near = new nearApi.Near({
      keyStore: new nearApi.keyStores.BrowserLocalStorageKeyStore(),
      networkId: 'testnet',
      nodeUrl: 'https://rpc.testnet.near.org',
      walletUrl: 'https://wallet.testnet.near.org'
    });

    // connect to the NEAR Wallet
    const nearWallet = new nearApi.WalletConnection(near, 'my-app');
    // connect to a NEAR smart contract
    // const contract = new nearApi.Contract(wallet.account(), 'guest-book.testnet', {
    //   viewMethods: ['getMessages'],
    //   changeMethods: ['addMessage']
    // });

    const nearConnectButton = document.getElementById('near-connect-btn');
    if (nearWallet.isSignedIn()) {
      nearConnectButton.textContent = 'NEAR Wallet Connected!'
    }

    // call the getMessages view method
    // contract.getMessages()
    //   .then(messages => {
    //     const ul = document.getElementById('messages');
    //     messages.forEach(message => {
    //       const li = document.createElement('li');
    //       li.textContent = `${message.sender} - ${message.text}`;
    //       ul.appendChild(li);
    //     })
    //   });

    // Either sign in or call the addMessage change method on button click
    document.getElementById('near-connect-btn').addEventListener('click', () => {
      // if (wallet.isSignedIn()) {
      //   contract.addMessage({
      //     args: { text: document.getElementById('text').value },
      //     amount: nearApi.utils.format.parseNearAmount('1')
      //   })
      // } else {
      nearWallet.requestSignIn({});
      // }
    });

  </script>

</html>